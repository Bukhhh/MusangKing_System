<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - MusangKing System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .doc-section {
            margin-bottom: 3rem;
        }

        .doc-section h2 {
            border-bottom: 2px solid var(--primary-pale);
            padding-bottom: 0.5rem;
            color: var(--primary-dark);
            margin-bottom: 1.5rem;
        }

        .pipeline-flow {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8f9fa 0%, #e8f5e9 100%);
            padding: 2rem;
            border-radius: var(--radius-md);
            margin: 2rem 0;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .flow-step {
            background: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-sm);
            text-align: center;
            border: 1px solid #eee;
            flex: 1;
            min-width: 120px;
            transition: all 0.3s ease;
        }

        .flow-step:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .flow-step strong {
            display: block;
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .flow-step span {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .flow-arrow {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .method-box {
            background: #fff;
            border-left: 5px solid;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            box-shadow: var(--shadow-sm);
        }

        .method-primary {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #f1f8e9 0%, white 50%);
        }

        .method-fallback {
            border-color: #FF9800;
            background: linear-gradient(135deg, #fff3e0 0%, white 50%);
        }

        .method-box h3 {
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .method-steps {
            list-style: none;
            padding: 0;
            margin: 1rem 0 0 0;
        }

        .method-steps li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .method-steps li::before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: var(--primary);
            font-weight: bold;
        }

        .feature-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background: white;
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .feature-table thead tr {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .feature-table th,
        .feature-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .feature-table th {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .feature-table tbody tr:hover {
            background: var(--primary-pale);
        }

        .feature-table tbody tr:last-child td {
            border-bottom: none;
        }

        .model-card {
            background: white;
            border-radius: var(--radius-md);
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--primary-pale);
        }

        .model-card h4 {
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
        }

        .model-specs {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }

        .spec-item {
            background: var(--primary-pale);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--primary-dark);
        }

        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1rem;
            border-radius: var(--radius-sm);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .code-comment {
            color: #6a9955;
        }

        .code-keyword {
            color: #569cd6;
        }

        .code-string {
            color: #ce9178;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <a href="{{ url_for('index') }}"
                    style="text-decoration: none; display: flex; align-items: center; gap: 1rem;">
                    <img src="{{ url_for('static', filename='images/MK_LOGO.png') }}" alt="MusangKing Logo"
                        class="logo-image">
                    <div class="brand-info">
                        <span class="app-name">MusangKing</span>
                        <span class="subtitle">Classification System</span>
                    </div>
                </a>
            </div>

            <nav class="header-nav">
                <a href="{{ url_for('index') }}" class="nav-link">Dashboard</a>
                <a href="{{ url_for('datasets') }}" class="nav-link">Datasets</a>
                <a href="{{ url_for('documentation') }}" class="nav-link active">Documentation</a>
                <a href="{{ url_for('about') }}" class="nav-link">About Project</a>
            </nav>

            <div class="header-actions">
                <div class="version-badge">v2.0 Hybrid</div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="dashboard" style="display: block; max-width: 1200px; margin: 0 auto; padding: 2rem;">

            <div class="panel" style="padding: 2.5rem;">
                <h1 style="margin-bottom: 2rem; color: var(--primary-dark);">üìñ System Documentation</h1>

                <!-- 1. Overview Diagram -->
                <div class="doc-section">
                    <h2>1. System Pipeline Overview</h2>
                    <p>The MusangKing Classification System follows a standard image processing pipeline with K-Means
                        segmentation as the primary method.</p>

                    <div class="pipeline-flow">
                        <div class="flow-step">
                            <strong>üì§ Input</strong>
                            <span>Image Upload</span>
                        </div>
                        <span class="flow-arrow">‚Üí</span>
                        <div class="flow-step">
                            <strong>üîß Preprocessing</strong>
                            <span>Gamma (0.6) & Resize</span>
                        </div>
                        <span class="flow-arrow">‚Üí</span>
                        <div class="flow-step">
                            <strong>üé® Segmentation</strong>
                            <span>K-Means (K=3)</span>
                        </div>
                        <span class="flow-arrow">‚Üí</span>
                        <div class="flow-step">
                            <strong>üìä Features</strong>
                            <span>5 Geometric + Color</span>
                        </div>
                        <span class="flow-arrow">‚Üí</span>
                        <div class="flow-step">
                            <strong>ü§ñ Classification</strong>
                            <span>SMOTE Ensemble</span>
                        </div>
                    </div>
                </div>

                <!-- 2. Segmentation Strategy -->
                <div class="doc-section">
                    <h2>2. Segmentation Strategy</h2>
                    <p>The system uses K-Means clustering as the primary segmentation method, with an AI fallback for
                        challenging images.</p>

                    <div class="method-box method-primary">
                        <h3>‚úÖ Primary Method: K-Means Clustering</h3>
                        <p>Standard academic approach using CIE LAB color space for robust color-based segmentation.</p>
                        <ul class="method-steps">
                            <li><strong>Gamma Correction (Œ≥=0.6):</strong> Enhance contrast for better cluster
                                separation</li>
                            <li><strong>LAB Conversion:</strong> Transform to perceptually uniform color space</li>
                            <li><strong>K-Means (K=3):</strong> Cluster into Background, Husk, and Flesh regions</li>
                            <li><strong>Morphological Cleanup:</strong> Remove noise and fill holes</li>
                        </ul>
                    </div>

                    <div class="method-box method-fallback">
                        <h3>‚ö†Ô∏è Fallback Method: AI Segmentation (rembg)</h3>
                        <p>Automatically triggered if K-Means produces an empty or <1% area mask.</p>
                                <ul class="method-steps">
                                    <li>Uses U-2 Net deep learning model</li>
                                    <li>Handles complex backgrounds and lighting conditions</li>
                                    <li>Only activated when K-Means fails completely</li>
                                </ul>
                    </div>
                </div>

                <!-- 3. Feature Extraction -->
                <div class="doc-section">
                    <h2>3. Feature Extraction (Phase 4)</h2>
                    <p>We extract morphological and color features from the segmented mask for classification:</p>

                    <table class="feature-table">
                        <thead>
                            <tr>
                                <th>Feature</th>
                                <th>Formula / Description</th>
                                <th>Used For</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Compactness</strong></td>
                                <td>(Perimeter¬≤) / Area ‚Äî Measures shape irregularity</td>
                                <td>Variety & Ripeness</td>
                            </tr>
                            <tr>
                                <td><strong>Smoothness</strong></td>
                                <td>Approx. Vertices / Perimeter ‚Äî Contour complexity</td>
                                <td>Variety & Ripeness</td>
                            </tr>
                            <tr>
                                <td><strong>Aspect Ratio</strong></td>
                                <td>Width / Height of bounding box</td>
                                <td>Variety</td>
                            </tr>
                            <tr>
                                <td><strong>Rectangularity</strong></td>
                                <td>Area / Bounding Box Area</td>
                                <td>Variety</td>
                            </tr>
                            <tr>
                                <td><strong>Mean Red</strong></td>
                                <td>Average Red channel intensity (BGR)</td>
                                <td>Variety</td>
                            </tr>
                            <tr>
                                <td><strong>Mean Hue</strong></td>
                                <td>Average Hue value (HSV)</td>
                                <td>Ripeness</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 4. Classification Models -->
                <div class="doc-section">
                    <h2>4. Classification Models</h2>
                    <p>Two ensemble models trained with SMOTE upsampling for balanced class distribution:</p>

                    <div class="model-card">
                        <h4>üçà Variety Classification Model</h4>
                        <p>Classifies durian into Musang King (D197), Black Thorn (D200), or Udang Merah (D175).</p>
                        <div class="model-specs">
                            <span class="spec-item">Ensemble: SVM + RF + XGBoost</span>
                            <span class="spec-item">Voting: Soft (Probability)</span>
                            <span class="spec-item">Features: 5</span>
                            <span class="spec-item">Accuracy: ~96%</span>
                        </div>
                    </div>

                    <div class="model-card">
                        <h4>üå°Ô∏è Ripeness Classification Model</h4>
                        <p>Determines ripeness level: Mature, Immature, or Defective.</p>
                        <div class="model-specs">
                            <span class="spec-item">Ensemble: SVM + RF + XGBoost</span>
                            <span class="spec-item">Voting: Soft (Probability)</span>
                            <span class="spec-item">Features: 3</span>
                            <span class="spec-item">Accuracy: ~94%</span>
                        </div>
                    </div>
                </div>

                <!-- 5. Security Features -->
                <div class="doc-section">
                    <h2>5. Security & Validation</h2>
                    <p>The system includes a confidence threshold to reject non-durian objects:</p>

                    <div class="code-block">
                        <span class="code-comment"># Security Check: Is it actually a durian?</span><br>
                        <span class="code-keyword">CONFIDENCE_THRESHOLD</span> = <span
                            class="code-string">40.0</span><br><br>
                        <span class="code-keyword">if</span> v_conf < CONFIDENCE_THRESHOLD:<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> <span
                                class="code-string">"Unknown Object / Not Durian"</span>, <span
                                class="code-string">"unknown"</span>, v_conf
                    </div>

                    <p style="margin-top: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                        <strong>Logic:</strong> If the highest prediction probability is below 40%, the object is
                        unlikely to be a durian from our training set. The system gracefully rejects it instead of
                        making an incorrect classification.
                    </p>
                </div>

            </div>
        </main>

        <footer class="footer">
            <p>MusangKing Classification System &copy; 2026 | CSC566 Image Processing Project</p>
        </footer>
    </div>
</body>

</html>